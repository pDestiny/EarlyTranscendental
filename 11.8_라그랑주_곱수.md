# 11.8 라그랑주 곱수

라그랑주 곱수법은 제약 조건이 있는 최적화 문제에서, 목적 함수의 기울기가 제약 조건의 기울기와 평행하다는 사실을 이용하는 방법이야.


---

## 문제의 상황

제약 조건 $$g(x, y, \ldots) = 0$$ 하에서 목적 함수 $$f(x, y, \ldots)$$를 최대 또는 최소로 만드는 값을 찾고자 한다.

즉, 다음과 같은 최적화 문제를 다룬다:
$$
\max_{x, y, \ldots} f(x, y, \ldots) \quad \text{subject to} \quad g(x, y, \ldots) = 0
$$

## 기본 아이디어

제약 조건이 없는 극값 문제에서는 $\nabla f = 0$ 인 점을 찾는다.

하지만 제약 조건이 있을 때는, 극값이 목적 함수의 등고선과 제약 조건 곡선이 접하는 지점에서 발생한다. 이때, $f$의 기울기와 $g$의 기울기가 평행하므로,
$$
\nabla f = \lambda \nabla g
$$
를 만족하는 $\lambda$ (라그랑주 곱수)가 존재한다.

## 해법 절차

1. **라그랑주 함수 작성**  
   $$
   \mathcal{L}(x, y, \ldots, \lambda) = f(x, y, \ldots) - \lambda \, g(x, y, \ldots)
   $$

2. **미분 방정식 세우기**  
   모든 변수와 $\lambda$에 대해 편미분하여 0이 되는 점을 찾는다.
   $$
   \frac{\partial \mathcal{L}}{\partial x} = 0, \quad
   \frac{\partial \mathcal{L}}{\partial y} = 0, \quad
   \ldots, \quad
   \frac{\partial \mathcal{L}}{\partial \lambda} = 0
   $$
   마지막 식은 $g(x, y, \ldots) = 0$이 됨.

3. **연립 방정식 풀기**  
   위의 식들을 연립하여 $x, y, \ldots, \lambda$ 값을 구한다.

## 예시

**문제:**  
$f(x, y) = x^2 + y^2$를 $x + y = 1$이라는 제약 조건 하에서 최소화하라.

**1. 라그랑주 함수:**  
$$
\mathcal{L}(x, y, \lambda) = x^2 + y^2 - \lambda (x + y - 1)
$$

**2. 편미분 방정식:**  
$$
\begin{align}
\frac{\partial \mathcal{L}}{\partial x} &= 2x - \lambda = 0 \\
\frac{\partial \mathcal{L}}{\partial y} &= 2y - \lambda = 0 \\
\frac{\partial \mathcal{L}}{\partial \lambda} &= -(x + y - 1) = 0    
\end{align}
$$

**3. 연립 방정식 풀이:**  
첫 두 식에서 $2x = \lambda,\, 2y = \lambda \implies x = y$  
세 번째 식에서 $x + y = 1$
따라서 $x = y = 0.5$
$\lambda = 1$

**4. 답:**  
최소값은 $f(0.5, 0.5) = (0.5)^2 + (0.5)^2 = 0.5$

## 확장

여러 개의 제약 조건 $g_1(x, y, \ldots) = 0,\, g_2(x, y, \ldots) = 0,\, \ldots$이 있을 때는,
$$
\mathcal{L}(x, y, \ldots, \lambda_1, \lambda_2, \ldots) = f(x, y, \ldots) - \lambda_1 g_1(x, y, \ldots) - \lambda_2 g_2(x, y, \ldots) - \cdots
$$
로 확장하여 각 제약마다 라그랑주 곱수를 도입한다.

## 정리

- **라그랑주 곱수법**은 제약 조건이 있는 최적화에서 목적 함수와 제약 조건의 기울기가 평행한 점을 찾는 방법이다.
- 라그랑주 함수를 정의하고, 모든 변수에 대해 편미분하여 연립 방정식을 푼다.
- 여러 제약 조건도 확장 가능하다.

---

이번 절에서는 $g(x, y, z) = k$꼴의 제한을 만족시키면서 일반적인 함수 $f(x, y,z)$를 ㅚ대화하거나 최소화하는 라그랑주 방법을 제시한다.

이변수 함수에 대해 라그랑주 방법의 기하학적 기초를 설명하는 것이 더 쉽다. 그러므로 먼서 $g(x, y) = k$꼴의 제한을 만족시키면서 $f(x, y)$의 최댓값과 최소값을 찾아보자. 바꿔 말하면, 점 $(x, y)$가 등위 곡선 $g(x, y) = k$에 놓여 있도록 제한할 때 $f(x, y)$의 최댓값과 최솟값을 찾는다. 

그림 1은 곡선 $g(x, y) = k$와 $f$의 등위 곡선 몇 개를 함께 보여준다. 이것들의 방정식은 $c = 7, 8, 9, 10, 11$일 때의 $f(x, y) = c$이다. $g(x, y) = k$를 만족시키면서 $f(x, y)$를 최대화하려면, 등위 곡선 $f(x, y) = c$가 $g(x, y) = k$와 교차하는 $c$의 최대값을 찾아야 한다. 이런 경우는 이런 곡선들이 서로 접할 때, 곧 공통 접선이 존재할 때 나타난다. 이것은 접점 $(x_0, y_0)$에서의 법선들이 일치함을 뜻한다. 그러므로 물매 벡터들이 서로 평행이다. 곧, 적당한 스칼라 $\lambda$에 대해 $\nabla f(x_0, y_0) = \lambda \nabla g(x, y)$이다.

> <span style="color:blue"> 라그랑주 곱수 방법(Lagrange multiplier)</span>
> 제한 $g(x, y, z) = k$를 만족시키는 $f(x, y, z)$의 최대값과 최솟값을 찾기 위해서 [이런 최댓값과 최솟값이 존재하고 곡면 $g(x, y, z) = k$에서 $\nabla g \ne 0$이라고 가정했을 때]
> (a) 다음을 만족시키는 $x, y, z, \lambda $의 값을 모두 찾는다.
> $$\nabla f(x, y, z) = \lambda \nabla g(x, y, z), g(x, y, z) = k$$
> (b) 단계 (a)에서 얻은 모든 점 $(x, y, z)$에서 $f$의 값을 찾는다. 이런 값 중에서 가장 큰 것이 $f$의 최대값이고, 가장 작은 것이 $f$의 최솟갓이다.

### 보기 1
뚜껑이 없는 직육면체 상자 $12m^2$의 보드지로 만든다. 이런 상자의 최대 들이를 찾아라.

**풀이**

$$
\begin{align}
g(x, y, z) &= 2xz + xy + 2yz = 12 \\
f(x, y, z) &= xyz
\end{align}
$$

라그랑주 곱수 방법에 따르면 $\nabla f(x, y, z) = \lambda \nabla g(x, y, z)$의 연립방정식을 풀어야 한다.

$$
\begin{align}
\lambda \nabla g(x, y, z) &= \lambda \langle 2z + y, 2z + x, 2x + 2y \\
\nabla f(x, y, z) &= \langle yz, xz, xy \rangle \rangle \\
yz &= \lambda (2z + y) \\
xz &= \lambda (2z + x) \\
xy &= \lambda (2x  + 2y)
\end{align}
$$

8, 9, 10번 공식에 각각 $x, y, z$를 곱해서 연립방정식을 풀어보면

$$
\begin{align}
2xz + xy &= 2yz + xy \\
x &= y \\
2xz + xy &= 2xz + 2yz \\
xy &= 2yz \\
x &= 2z \\
x &= y = 2z
\end{align}
$$

이를 $g(x, y, z)$에 대입하면 $g(x, y, z) = 4z^2 + 4z^2 = 4z^2 = 12$임으로 $z = 1, x = 2, y = 2$일 때 최대 들이가 될 수 있음을 알 수 있다.

### 보기 2
원 $x^2 + y^2 = 1$에서 함수 $f(x, y) = x^2 + 2y^2$의 최댓값과 최솟값을 찾아라

**풀이**

$f(x, y) = x^2 + 2y^2$이고 $g(x, y) = x^2 + y^2 = 1$이고 라그랑주 곱수 방법을 이용하면

$$
\begin{align}
2x &= \lambda 2x \\
4y &= \lambda 2y \\
x^2 + y^2 &= 1
\end{align}
$$

따라서 $\lambda = 1$이거나 $x = 0$이다. $\lambda = 1$인 경우 $4y = \lambda 2y$에서 $4y = 2y$가 되어야 함으로 모순이다. 따라서 $x = 0$인 경우 $y = \pm 1$이다. 반대로 $y$에 대해서도 $y = 0$인 경우 $x = \pm 1$이다.

$(0, 1), (0, -1), (1, 0), (-1, 0)$을 계산해보면 최대값은 $f(0, \pm 1) = 2$, 최솟값은 $f(\pm 1, 0) = 1$이다.

### 보기 3

원판 $x^2 + y^2 \le 1$에서 $f(x, y) = x^2 + 2y^2$의 최댓값과 최솟값을 찾아라.

**풀이**

$$
\begin{align}
2x &= \lambda 2x \\
4y &= \lambda 2y \\
x^2 + y^2 &\le 1
\end{align}
$$

보기 2와 유사하게 $x = 0$일 때 $|y| \le 1$이고 $y = 0$일 때 $|x| \le 1$이다. 여기서 임계점은 경계를 제외하고 $(0, 0)$뿐이다. $f(0, 0) = 0$임으로 최솟값은 0이며 최대값은 보기 2와 같은 2이다.

### 보기 4

구면 $x^2 + y^2 + z^2 = 4$에 있는 점 중에서 점 $(3, 1, -1)$과 가장 가까운 점과 먼 점을 찾아라

**풀이**

구면에서 점 $(3, 1, -1)$까지의 거리의 공식은 아래와 같다.

$$
\begin{align}
d &= \sqrt{(x - 3)^2 + (y - 1)^2 + (z + 1)^2} \\
d^2 &= x^2 - 6x + 9 + y^2 - 2y + 1 + z^2 + 2z + 1 \\
&= x^2 + y^2 + z^2 -6x -2y +2z + 11
\end{align}
$$

따라서 $f(x, y, z) = x^2 + y^2 + z^2 -6x -2y +2z + 11$로 보았을 때 $x^2 + y^2 + z^2 = 4$를 만족시키는 라그랑주 곱수 문제로 변형시킬 수 있다.

$$
\begin{align}
x - 3 &= \lambda x \\
y - 1 &= \lambda y \\
z + 1 &= \lambda z \\
x^2 + y^2 + z^2 &= 4
\end{align}
$$

$\lambda$에 관한 식으로 풀면

$$
\frac{3^2}{(1 - \lambda)^2} + \frac{1^2}{(1 - \lambda)^2} + \frac{(-1)^2}{(1 - \lambda)^2} = 4
$$

$\lambda$의 해를 구하면 $\lambda = 1 \pm \frac{\sqrt{11}}{2}$이다. 

이에 대응하는 점 $(x, y, z)$는 다음과 같다.

$\left(6/\sqrt{11}, 2/\sqrt{11}, -2\sqrt{11} \right), \left(-6/\sqrt{11}, -2/\sqrt{11}, 2\sqrt{11} \right)$이 중에서 가장 가까운 점은 첫번째 점이고, 가장 먼 점은 두 번째 점임을 알 수 있다.

---

## 두 가지 제한

> $$\nabla f(x_0, y_0, z_0) = \lambda g(x_0, y_0, z_0) + \mu\nabla h(x_0, y_0, z_0)$$




